<html>

<head>
  <meta charset="utf-8">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="../../../images/struc.css" media="screen" />
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.16.0/jquery.validate.js"></script>
</head>

<body>
<div id="wrapper">
    <div id="encabezado"></div>
    <div id="content">
        <br>
<br>
<br>
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-sm-offset-3">
            <div id="mensaje" class="alert alert-danger">
                <label id="mensaje1"></label>
            </div>
            <div class="page-header text-center">
                <h2 id="hRegistro">Registro de Insumos y Reactivos</h2>
            </div>
          <form id="formRegistrarInsumo" action="../guardarInsumo/" method="post" enctype="multipart/form-data" novalidate>
               <label><b>Código</b></label><input class="form-control input-md" id="codigo" name="codigo" placeholder="Ingrese un código de referencia" type="text" required><br>
           <label><b>Nombre</b></label><input class="form-control input-md" id="nombre" name="nombre" placeholder="Ingrese el nombre" type="text"><br>
              <label><b>Descripción</b></label><textarea rows="4"class="form-control input-md" id="descripcion" name="descripcion" placeholder="Descripción del insumo o reactivo" type="text" required></textarea><br>
              <label><b>Valor Unitario</b></label><div class="input-group"><span class="input-group-addon">COP</span><input class="form-control input-md" id="valor" name="valor" type="text" placeholder="Ingrese el valor unitario" required></div><br>
              <label><b>Unidades Existentes</b></label><input id="unidades" name="unidades" type="number" class="form-control input-md" min="1" max="50" required maxlength="2" minlength="1"><br>
           <label class="required" for="id_clasificacion">Clasificacion:</label>
            <br>
              <select id="clasificacion" name="clasificacion" required class="form-control">
                  <option value="" selected="selected">---------</option>
                  <optgroup label="Materiales Vivos">
                      <option value="Bac">Bacterias</option>
                      <option value="Hon">Hongos</option>
                    </optgroup>
                    <optgroup label="Medios de Cultivo">
                    <option value="Glu">Glucosa</option>
                    <option value="Fru">Fructuosa</option>
                    <option value="Tri">Triptona</option>
                    <option value="Pep">Peptona</option>
                    </optgroup>
                    <optgroup label="Micronutrientes">
                    <option value="Fe">Hierro</option>
                    <option value="Mg">Magnesio</option>
                    <option value="P">Fosforo</option>
                    </optgroup>
                    <optgroup label="Manipulacion ADN y Proteinas">
                    <option value="Pri">Primers</option>
                    <option value="Kem">Kits de extraccion metagenomica</option>
                    <option value="KeADN">Kits de extraccion ADN aislado</option>
                    <option value="Pup">Purificador de proteinas</option>
                    <option value="Enr">Enzimas de restriccion</option>
                    <option value="Pro">Proteasas</option>
                    </optgroup>
                  <optgroup label="Otros">
                      <option value="Otros">Moleculas genericas</option>
                  </optgroup>
                    </select>
              <br>
              <label><b>Unidad Medida</b></label><select class="form-control" id="medida" name="medida" required></select><br>
               <label><b>Cantidad Unitaria</b></label><input id="cantidad" name="cantidad" type="number" class="form-control input-md" min="1" max="9999.9999" required maxlength="4" minlength="1"><br>
              <label><b>Proveedor</b></label><select class="form-control" id="proveedor" name="proveedor" required></select><br>
              <label for="id_imageFile">Imagen:</label><input id="imageFile" name="imageFile" type="file" required/>
                <br>
              <input type="submit" value="Guardar" class="btn btn-primary"/>
          <a href="../verRecursos">Cancelar</a></form>
        </div>

      </div>
    </div>
    </div>
    <div id="pie"></div>
</div>
</body>
<script>
    (function(){
        try {
            $("#encabezado").load("../encabezado");
            $("#pie").load("../pie");
        }catch (exc){
            alert(exc.message);
        }
    })();

    (function() {
        $.getJSON("../obtenerTiposMedida").done(function (data) {
            data = $.parseJSON(data);
            var tipoBodega = $("#medida");
            tipoBodega.append($("<option />").val("").text("Seleccione Medida..."));
            $(data).each(function () {
                tipoBodega.append($("<option />").val(this.pk).text(this.fields.nombre));
            });
        })
    })();

    (function() {
        $.getJSON("../obtenerProveedores").done(function (data) {
            data = $.parseJSON(data);
            var tipoBodega = $("#proveedor");
            tipoBodega.append($("<option />").val("").text("Seleccione un Proveedor..."));
            $(data).each(function () {
                tipoBodega.append($("<option />").val(this.pk).text(this.fields.first_name));
            });
        })
    })();

    $("#mensaje").hide();


    $("#formRegistrarInsumo").validate({
        //specify the validation rules
        rules: {
            codigo: {
                    required: true,
                    maxlength: 10
                },
            nombre: {
                    required: true,
                    maxlength: 50
                },
            descripcion:
                {
                    required: true,
                    maxlength: 200
                },
            valor: "required",
            unidades: "required",
            clasificacion: "required",
            medida: "required",
            cantidad: "required",
            imageFile: "required",
            proveedor: "required",
        },

        //specify validation error messages
        messages: {
            codigo:
                {
                    required: "Es requerido un código para la creacion del recurso",
                    maxlength: "El código no debe superar los 10 caracteres"
                },
            nombre:
                {
                    required: "Es requerido un nombre para la creacion del recurso",
                    maxlength: "El nombre no debe superar los 50 caracteres"
                },
            descripcion:
                {
                    required: "Es requerido una descripción para la creacion del recurso",
                    maxlength: "La descripción no debe superar los 200 caracteres"
                },
            valor: "Es necesario un valor unitario para la creación del recurso",
            unidades: "Son necesarias las unidades existentes para la creación del recurso",
            clasificacion: "Es necesario elegir una clasificacion para la creación del recurso",
            medida: "Es necesario elegir una unidad de medida para la creación del recurso",
            cantidad: "Es necesario elegir una cantidad unitaria para la creación del recurso",
            imageFile: "Es necesario subir una imagen para la creación del recurso",
            proveedor: "Es necesario elegir un proveedor para la creación del recurso"
        },

        //submitHandler: function(form){
        //    form.submit();
        //}

    });

    $('form').submit(function (e) {
        var formData = new FormData($("#formRegistrarInsumo")[0]);
        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data && data.mensaje && data.mensaje != "ok") {
                    $("#mensaje1").text(data.mensaje);
                    $("#mensaje").show();
                } else {
                    window.location = "../verRecursos";
                }
            }
        });
        e.preventDefault();
    });
</script>
</html>